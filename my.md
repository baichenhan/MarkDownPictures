# 有限元基础知识整理
## 第一章 预备知识
### 弹性体的基本假设
- 物体内的物质连续性假设，物体中无空隙。
- 物质均匀性假设，物质内各位置具有相同的属性。
- 各向同性假设，物体内同一位置的各个方向具有相同的特征。
- 材料是线弹性材料，应力与应变是线弹性关系。
- 小变形假设，因外力产生的形变量远小于本身尺寸。

有限元分析通常情况下的6个应力分量： 三个正应力分量和三个剪应力分量。对应会有6个应变分量：三个正应变和三个剪应变。而位移只有对应轴的三个分量：u，v，w。

### 弹性力学的基本方程
- 弹性力学的平衡方程，在三个坐标轴方向上面力分量与体力分量和为0
- 几何方程，即应变位移关系方程，小变形情况下的应变向量与位移向量的关系方程
- 物理方程，即应力应变方程，如各向同性线弹性材料应力应变关系式

由平衡方程，几何方程和物理方程组成的弹性力学问题基本方程含有15个方程和15个未知量。引入力的边界条件和位移边界条件后，就使方程有了确定的解。

变形体的虚功原理：变形体中满足平衡的力系在任意满足协调条件的变形状态上做的虚功等于0，即体系外力虚功与体系内力虚功之和等于0

### 虚功原理
- 虚位移原理：如果力系是平衡的，那么他们在虚位移和虚应变上所做的功总和为0，反之，如果力系在虚位移（虚应变）上所做的功之和为0，则力系一定是平衡的。虚位移原理是平衡方程和力的边界条件的等效积分“弱”形式。
- 虚应力原理：如果位移是协调的，则虚应力和虚边界约束反力在他们上面所做的功的总和为0，反之，若上述虚力系在他们上面所做的功之和为0，则他们一定是满足位移协调的。虚应力原理是几何方程和位移边界条件的等效积分“弱”形式。
- 需要指出，无论是虚位移原理还是虚应力原理，他们所依赖的几何方程和平衡方程都是基于小变形假设的相关理论推导的，所以他们不能直接应用于大变形情况的力学问题中。但他们的推导过程均未涉及物理方程（应力应变方程）所以均可应用于线弹性/非线弹性/弹塑性等问题中。

### 线弹性力学的变分原理
- 最小位能原理：在所有区域内满足几何关系，在边界上满足给定位移条件的可能位移中，真实位移使系统总位能取最小值（驻值）。
- 最小余能原理：在所有在弹性体内满足平衡方程，在边界上满足力的边界条件的可能应力中，真实应力使系统的总余能取最小值(驻值)。
- 利用最小位能原理和最小余能原理求得的近似解具有位移场的上界和下界性质，对工程计算具有重要实际意义。

## 第二章 弹性力学问题有限单元法的一般原理和表达格式
位移元：以结点位移为单元的基本未知量，并基于最小位能原理建立的有限单元称为位移元，是有限元中最常用的单元。
### 平面问题3结点三角形单元的有限元格式

![avatar](https://github.com/baichenhan/MarkDownPictures/raw/main/pict.png)

三角形三个角结点的编号分别为i，j，k。每个结点有[a<sub>i</sub>] = {u<sub>i</sub>, v<sub>i</sub>}<sup>T</sup>两个自由度（位移分量），则每个三结点三角形单元有6个自由度，即[a<sup>e</sup>] = {u<sub>i</sub>, v<sub>i</sub>, u<sub>j</sub>, v<sub>j</sub>, u<sub>m</sub>, v<sub>m</sub>}<sup>T</sup>

单元的位移模式及插值函数：
3结点三角形的位移模式一般选取一次多项式：
- u = β<sub>1</sub> + β<sub>2</sub>x + β<sub>3</sub>y
- v = β<sub>4</sub> + β<sub>5</sub>x + β<sub>6</sub>y

β<sub>1</sub>~β<sub>6</sub>是6个待定系数，称为广义坐标，可由结点的位移来表示
  
带入结点的坐标可以得到（以位移分量u示例）：
- u<sub>i</sub> = β<sub>1</sub> + β<sub>2</sub>x<sub>i</sub> + β<sub>3</sub>y<sub>i</sub>
- u<sub>j</sub> = β<sub>1</sub> + β<sub>2</sub>x<sub>j</sub> + β<sub>3</sub>y<sub>j</sub>
- u<sub>m</sub> = β<sub>1</sub> + β<sub>2</sub>x<sub>m</sub> + β<sub>3</sub>y<sub>m</sub>

对应系数行列式的值为2A（A为三角形单元的面积）

则可以解出广义坐标β<sub>1</sub>~β<sub>3</sub>的表达式如下：
- β<sub>1</sub> = 1/2A(a<sub>i</sub>u<sub>i</sub> + a<sub>j</sub>u<sub>j</sub> + a<sub>m</sub>u<sub>m</sub>)
- β<sub>2</sub> = 1/2A(b<sub>i</sub>u<sub>i</sub> + b<sub>j</sub>u<sub>j</sub> + b<sub>m</sub>u<sub>m</sub>)
- β<sub>3</sub> = 1/2A(c<sub>i</sub>u<sub>i</sub> + c<sub>j</sub>u<sub>j</sub> + c<sub>m</sub>u<sub>m</sub>)

同理也可求得广义坐标β<sub>4</sub>~β<sub>6</sub>的表达式如下：
- β<sub>4</sub> = 1/2A(a<sub>i</sub>v<sub>i</sub> + a<sub>j</sub>v<sub>j</sub> + a<sub>m</sub>v<sub>m</sub>)
- β<sub>5</sub> = 1/2A(b<sub>i</sub>v<sub>i</sub> + b<sub>j</sub>v<sub>j</sub> + b<sub>m</sub>v<sub>m</sub>)
- β<sub>6</sub> = 1/2A(c<sub>i</sub>v<sub>i</sub> + c<sub>j</sub>v<sub>j</sub> + c<sub>m</sub>v<sub>m</sub>)

且上式中的a<sub>i</sub>，b<sub>i</sub>，c<sub>i</sub>可由结点坐标所表示，则可以将β<sub>1</sub>~β<sub>6</sub>代回，得到：
- u = N<sub>i</sub>u<sub>i</sub> + N<sub>j</sub>u<sub>j</sub> + N<sub>m</sub>u<sub>m</sub>
- v = N<sub>i</sub>v<sub>i</sub> + N<sub>j</sub>v<sub>j</sub> + N<sub>m</sub>v<sub>m</sub>

其中N<sub>i</sub> = 1/2A(a<sub>i</sub> + b<sub>i</sub>x + c<sub>i</sub>y),   N<sub>i</sub>, N<sub>j</sub>,  N<sub>m</sub>称为单元的插值函数，也叫形函数，是坐标x和y的一次函数，a<sub>i</sub>, b<sub>i</sub>, c<sub>i</sub>……,c<sub>m</sub>是常数，取决于三结点三角形单元的三个结点坐标(x<sub>i</sub>, y<sub>i</sub>), (x<sub>j</sub>, y<sub>j</sub>), (x<sub>m</sub>, y<sub>m</sub>)。

插值函数有如下三个重要性质：
1. 在i结点上，插值函数的值N<sub>i</sub> = 1，N<sub>j</sub> = 0， N<sub>m</sub> = 0.其余两结点上同理
2. 在单元中的任意一点，插值函数的和应该等于1，即有N<sub>i</sub> + N<sub>j</sub> + N<sub>m</sub> = 1，能反映出单元的刚体位移。
3. 对于现在的3结点三角形单元，位移插值函数是线性的，在单元内部及边界上的位移也是线性的，保证了相邻单元在公共边界上位移的连续性。
   
将上面所求得的位移解代入几何方程 **ε** = **L u** = **L N a<sup>e</sup>**  = [B<sub>i</sub>  B<sub>j</sub>   B<sub>m</sub>] **a<sup>e</sup>**  = **B a<sup>e</sup>** 可以求得应变矩阵[B]，其中 **N** = [N<sub>i</sub>  N<sub>j</sub>   N<sub>m</sub>], **L**是平面问题的微分算子。

[B]中的参数是单元形状的参数，结点的坐标确定之后，其与x，y无关。[B]是常量阵，当单元的结点位移 **a<sup>e</sup>** 确定后，可以由[B]转换求得单元应变均为常量，即在载荷作用下的单元中各结点具有同一的ε<sub>x</sub>, ε<sub>y</sub>和γ<sub>xy</sub>值，3结点三角形单元是常应变单元。

单元应力可由物理方程 **σ** = **D ε**求得，**σ** = **D B a<sup>e</sup>** = **S a<sup>e</sup>** , **S** = **D B**, [S]称为应力矩阵，将平面应力应变弹性矩阵[D]代入，即可求得应力矩阵。与应变矩阵[B]相同，应力矩阵也是常量阵，即3结点三角形的各点的应力是相同的。

离散系统总位能计算中的未知量是结构的结点位移[a], 根据泛函原理，总位能取驻值的条件是它的一次变分为0，可得到有限元的求解方程为**K a** = **P**, 其中[K]为结构整体刚度矩阵，[P]为结构结点的载荷阵列 , 这就是利用最小位能原理建立的有限元方程。

有限单元法最后建立的方程组的系数矩阵[K]具有下列性质：
- 对称性
- 奇异性
- 稀疏性
- 非零元素呈带状分布

根据以上特性，必须引入位移边界条件来使矩阵的奇异性消失，然后充分利用其它特征，来提高系数矩阵的存储和求解效率。

由于我们在选择常函数的试探函数多项式时，并未考虑满足边界条件的要求，所以必须引入边界条件，使有限元方程满足位移边界条件。通常的几何边界条件是在若干个节点上给定场函数的值。对于求解位移场的问题，至少要提出足以约束系统刚体位移的几何边界条件，以消除结构刚度矩阵的奇异性。

### 引入强制边界条件的方法
- 直接代入法：将已知结点位移的自由度消去，得到一组待定结点位移方程在上，已知结点位移方程在下的修正方程。这种方法对原方程进行了重新排列，虽然新方程的阶数降低，但结点位移的顺序已经改变，不利于编写程序求解。
- 对角元素改1法：当给定结点的位移值为0时（如无移动铰支座、链杆支座），可在系数矩阵[K]中，将与零位移结点对应的行列中，主对角线元素改为1，其他同行同列元素改为0，在载荷矩阵[P]中，将与零位移结点对应的元素改为0，对给定所有零位移结点依次做此修正，全部修正完再求解。此方法引入强制位移条件比较简单，而且不改变原方程阶数和结点未知量的顺序，但是只能用于给定零位移的情况。
- 对角元素乘大数法：当有结点位移为给定值时，将该行方程修改如下：该行的主对角线元素乘以大数α（量级为10<sup>10</sup>左右）, 并将对应的载荷阵列中的数值改为α与原主对角线元素与给定位移值的乘积。对所有给定位移值都做以上修正，则解修正后的方程可得所有结点的位移值。这个方法使用起来简单，对任意给定的位移（零位移与非零位移）均适用，方程阶数和结点顺序都不变，编写程序方便，在有限元中经常采用。
  
引入位移边界条件后，消除了[K]矩阵的奇异性，可求出结构的结点位移[a]，然后回到单元中，利用单元的结点位移和几何方程可求出单元的应变情况，利用单元的应变和物理方程可求出单元的应力情况。

选择单元位移函数的一般原则：
1. 广义坐标的个数与结点自由度相等，如平面3结点三角形，有6个结点自由度，因此两个方向各取三项多项式。
2. 选取多项式时，常数项和坐标的一次项必须完备，用以反应单元的刚体位移和常应变。
3. 多项式的选取应该从低阶到高阶，尽量选取完全多项式以提高单元精度，若由于项数限制不能选取完全多项式时，选取的多项式应具有坐标对称性，并且一个坐标方向的次数不应超过完全多项式的次数。

### 广义坐标有限元的一般格式
解决广义坐标有限元问题的一般形式：
1. 以广义坐标[β]为待定参数，给出单元内位移[u]， 对于采用三角形常应变单元有：
   - [β] = [β<sub>1</sub> β<sub>2</sub> β<sub>3</sub> β<sub>4</sub> β<sub>5</sub> β<sub>6</sub>]
   - u = β<sub>1</sub> + β<sub>2</sub>x + β<sub>3</sub>y
   - v = β<sub>4</sub> + β<sub>5</sub>x + β<sub>6</sub>y
2. 用单元结点的位移$\widetilde{a}$<sup>e</sup>表示出广义坐标[β]，为了方便表示解出[β]，单元结点位移排列可以写成 a<sup>e</sup> = [u<sub>1</sub> u<sub>2</sub> u<sub>3</sub> v<sub>1</sub> v<sub>2</sub> v<sub>3</sub>]<sup>T</sup>的形式，代入结点坐标可得 $\widetilde{a}$<sup>e</sup> = **A β**, 则可以解出 **β** = **A<sup>-1</sup> $\widetilde{a}$<sup>e</sup>**
3. 以单元结点的位移a<sup>e</sup>表示单元的位移函数 **u**，得到单元的插值函数矩阵[N]，对于三结点平面三角形有 **N<sup>*</sup>** = **Φ<sub>1x3</sub>$\widetilde{A}$<sup>-1</sup><sub>3x3</sub>** = [N<sub>1</sub> N<sub>2</sub> N<sub>3</sub>], 而N<sub>i</sub> = 1/2A(a<sub>i</sub> + b<sub>i</sub>x + c<sub>i</sub>y)（i = 1，2，3），将结点位移改为一般排列顺序a<sup>e</sup>, 则有[u] = [N][a<sup>e</sup>].对于平面3结点三角形，有[N] = [N<sub>1</sub> N<sub>2</sub> N<sub>3</sub>], **N<sub>i</sub>** = **I**N<sub>i</sub> （i = 1, 2, 3)
   
- 到此为止的1-3步是假设位移模式，求解广义坐标[β]，最后得到单元插值函数的过程，这三步是广义坐标有限元方法的特征。
4. 以单元结点位移a<sup>e</sup>表示应力和应变，对于应变，[ε] = [L][u] = **B(x,y)** a<sup>e</sup>，其中[B] = [L][N]，[L]是平面问题的微分算子，对于平面三角形问题 **ε** = [ε<sub>x</sub> ε<sub>y</sub> γ<sub>x</sub>]<sup>T</sup>, 对于应力 **σ** = **D ε** = **D B a<sup>e</sup>**, 当有初应力和初应变时[σ] = [D]([ε] - [ε<sub>0</sub>]) + [σ<sub>0</sub>] = [D][B][a<sup>e</sup>] - [D][ε<sub>0</sub>] + [σ<sub>0</sub>]
5. 用最小位能原理建立离散体系的结点平衡方程，对系统积分得到系统总位能的离散形式，并令总位能的变分等于0，得到 **K a** = **P**, 其中[K]为系统的整体刚度矩阵，[P]为结构的载荷阵列。
- 4-5是利用变分原理建立有限元方程，此处是利用最小位能原理建立以位移场为基本变量的有限元方程，以求解平衡问题。
6. 以适当的方式引入位移边界条件，例如
   - 直接代入法
   - 对角线元素改1法
   - 对角线元素乘大数法
7. 解有限元方程以得到结点位移解
8. 以解出的位移解进行项目所需的辅助计算，如应力解求解，应变求解等其他计算内容。
- 6-8是建立完毕有限元方程后的计算和解决实际问题的过程。

广义坐标有限元的问题：当位移函数选择不恰当时， 可能并不存在[A]<sup>-1</sup>而使广义坐标[β]无法求解，且当单元结点较多时，解出[β]的过程十分繁琐。

解决办法：可以利用自然坐标直接构造单元插值函数，跳过[β]的求解过程，从第4部开始建立和求解有限元方程。

### 有限元解的性质和收敛性
有限元解的收敛准则：
- 完备性要求：如果出现在泛函中场函数的最高阶导数是m阶，则有限元解收敛的条件之一是单元内场函数的试探函数至少是m次完全多项式，或者说试探函数中必须包含本身和直至m阶导数为常数的项。
- 协调性要求：如果出现在泛函中的最高阶导数是m阶，则试探函数在单元交界面上必须有C<sub>m-1</sub>连续性，即在相邻单元的交界面上应有函数直至m-1阶的连续导数。

简单的说，当选取的单元既完备又协调时，有限元的解是收敛的，即单元尺寸趋于零时有限元解趋于真实解，称这种单元为协调元。在某些情况下，可以放松对协调性的要求，只要单元能通过分片实验，有限元的解就依然收敛于正确的解，这种单元称为非协调单元。

### 高精度三角形单元:
- 二次单元：6结点平面三角形单元

![avatar](https://github.com/baichenhan/MarkDownPictures/raw/main/triangle_2.png)

位移函数取完全二次多项式

[β] = [β<sub>1</sub> β<sub>2</sub> … β<sub>12</sub>]<sup>T</sup>

[Φ] = [1 x y xy x<sup>2</sup> y<sup>2</sup>]

6结点平面三角形单元满足收敛性的完备性和协调性要求，因此6结点三角形是协调单元，且单元应力应变都在两个方向线性变化，精度比3结点平面三角形更高。

- 三次单元：10结点平面三角形单元

![avatar](https://github.com/baichenhan/MarkDownPictures/raw/main/triangle_3.png)

三次单元的位移模式是完全的三次多项式

[β] = [β<sub>1</sub> β<sub>2</sub> β<sub>3</sub> … β<sub>20</sub>]<sup>T</sup>

[Φ] = [1 x y x<sup>2</sup> xy y<sup>2</sup> x<sup>3</sup> x<sup>2</sup>y xy<sup>2</sup> y<sup>3</sup>]

10结点平面三角形也是协调元，且单元的应力应变是二次函数，精度高于2次单元（6结点平面三角形）

问题：采用广义坐标时，高精度三角形单元的[β], [K<sup>e</sup>], [P]的求解将十分冗繁。

### 面积坐标
![avatar](https://github.com/baichenhan/MarkDownPictures/raw/main/triangle_L.png)

三角形内任意一点与三个角点连接形成三个子三角形，S<sub>Pij</sub> = A<sub>m</sub>, S<sub>Pjm</sub> = A<sub>i</sub>, S<sub>Pim</sub> = A<sub>j</sub>, S<sub>ijm</sub> = A

则点P(L<sub>i</sub>, L<sub>j</sub>, L<sub>m</sub>)的位置可由三个面积比值确定：
- L<sub> i</sub> = A<sub> i </sub> / A
- L<sub> j</sub> = A<sub> j </sub> / A
- L<sub> m</sub> = A<sub> m </sub> / A
- A = A<sub> i </sub> + A<sub> j </sub> + A<sub> m </sub>

以面积坐标表示三角形则有：
- 三个角点分别为 i(1,0,0) , j(0,1,0) , m(0,0,1)
- 三条边分别为 j-m边 L<sub> i</sub> = 0, m-i边 L<sub> j</sub> = 0, i-j边 L<sub> m</sub> = 0
- 且对于三个面积坐标，由于A = A<sub> i </sub> + A<sub> j </sub> + A<sub> m </sub>, 所以有L<sub> i </sub> + L<sub> j </sub> + L<sub> m </sub> = 1,即3个面积坐标中仅有两个是独立的

### 面积坐标的三角形单元插值函数
- 线性三角形单元：（3结点平面三角形），插值函数是线性函数，可用角点的其他二角点直线方程左部的线性函数来构成，如对于角点1，利用2-3边方程：N<sub> 1</sub> = L<sub> 1</sub>，类似可得 N<sub> i</sub> = L<sub> i</sub>，(i = 1, 2, 3)
- 二次三角形单元：（6结点平面三角形单元），对于角点，可以选择两条直线，过除该角点外的所有结点，利用直线方程的左部作为线性函数构造插值函数，如角点1，利用2-3边方程和过边中点4-6的直线方程，并使结点1处的N<sub>1</sub> = 1, 有N<sub>1</sub> = (2L<sub>1</sub> - 1)L<sub>1</sub>, 整理可得，角点的插值函数 N<sub>i</sub> = (2L<sub>i</sub> - 1)L<sub>i</sub>  (i = 1, 2, 3).而对于边中点的结点，可以选择非此点所在的两条边的方程：N<sub>4</sub> = 4L<sub>1</sub>L<sub>2</sub>， N<sub>5</sub> = 4L<sub>2</sub>L<sub>3</sub>， N<sub>6</sub> = 4L<sub>3</sub>L<sub>1</sub>，最后还要检验，N<sub>i</sub>(L<sub>j</sub>) = δ<sub>ij</sub>, 以及$\sum$N<sub>i</sub> = 1是否满足

## 第三章 单元和插值函数的构造
### Lagrange单元
对于具有n个结点的一维单元，如果它的结点参数中只含有场函数的结点值，则单元内场函数可以插值表示为Φ = $\sum_1^n$N<sub>i</sub>Φ<sub>i</sub>, 其中插值函数N<sub>i</sub>(x)满足：N<sub>i</sub>(x<sub>j</sub>) = δ<sub>ij</sub>, 以及$\sum_1^n$N<sub>i</sub>(x) = 1。其中δ<sub>ij</sub> = 0 (i $\ne$ j), δ<sub>ij</sub> = 1 (i = j).

对于插值函数的构造，可以直接使用拉格朗日多项式，对n个结点的一维单元，插值函数可以采用n-1次拉格朗日插值多项式，即：
![avatar](https://github.com/baichenhan/MarkDownPictures/raw/main/Lagrange_0.png)

可以通过引入无量纲长度坐标（自然坐标）的方式将插值函数改写为以下两种格式：
- ![avatar](https://github.com/baichenhan/MarkDownPictures/raw/main/wulianggang_1.png)
- ![avatar](https://github.com/baichenhan/MarkDownPictures/raw/main/wulianggang_2.png)

应指出，Φ = $\sum_1^n$N<sub>i</sub>(ξ)Φ<sub>i</sub> = $\sum_1^n$l<sub>i</sub><sup>n-1</sup>(ξ)Φ<sub>i</sub>仍是ξ的n-1次完全多项式，满足收敛准则。且可通过坐标变换将直线单元转换为曲线单元，单元场函数仍然满足收敛准则。

Lagrange二次三角形单元与三次三角形单元：

![avatar](https://github.com/baichenhan/MarkDownPictures/raw/main/Lagrange_2.png)拉格朗日二次三角形单元
![avatar](https://github.com/baichenhan/MarkDownPictures/raw/main/Lagrange_2_1.png)

![avatar](https://github.com/baichenhan/MarkDownPictures/raw/main/Lagrange_3.png)拉格朗日三次三角形单元
![avatar](https://github.com/baichenhan/MarkDownPictures/raw/main/Lagrange_3_1.png)

### Lagrange矩形单元，Hermite矩形单元和Serendipity单元
- Lagrange矩形单元利用两个坐标方向的Lagrange多项式的乘积作插值函数，但随着插值方次的增高而增加了内结点，这种自由度的增加并不能提高单元的精度，因此实际中并不实用。
- Hermite矩形单元的插值函数利用两个坐标方向的一维Hermite多项式乘积得到，二阶混合导数的结点值也必须包含在结点参数中。
- 线性的，二次，三次的Serendipity单元只有角结点和边上结点，四次单元为了保证四次多项式是完全的，在中心内置了一个结点，相比Lagrange单元，完全多项式以外的高次项少得多，在提高精度时不冗余。

### 四面体单元
![avatar](https://github.com/baichenhan/MarkDownPictures/raw/main/3D.png)

类比平面三角形中引入的面积坐标，对于三维的四面体单元可以引入体积坐标，对四面体内任意一点P，其体积坐标为：
- L<sub> 1</sub> = V(P234) / V(1234)
- L<sub> 2</sub> = V(P341) / V(1234)
- L<sub> 3</sub> = V(P412) / V(1234)
- L<sub> 1</sub> = V(P123) / V(1234)
- 对于四面体一次单元（线性单元）：N<sub> i</sub> = L<sub> i</sub> (i = 1, 2, 3)
- 对于四面体二次单元：
    - 角结点：N<sub> i</sub> = (2L<sub> i</sub> - 1)L<sub> i</sub>   (i = 1, 2, 3, 4)
    - 棱内结点：
        - N<sub> 5</sub> = 4L<sub> 1</sub>L<sub> 2</sub>
        - N<sub> 6</sub> = 4L<sub> 1</sub>L<sub> 3</sub>
        - N<sub> 7</sub> = 4L<sub> 1</sub>L<sub> 4</sub>
        - N<sub> 8</sub> = 4L<sub> 2</sub>L<sub> 3</sub>
        - N<sub> 9</sub> = 4L<sub> 3</sub>L<sub> 4</sub>
        - N<sub> 10</sub> = 4L<sub> 2</sub>L<sub> 4</sub>
- 对于四面体三次单元：
    - 角结点：N<sub> i</sub> = 1/2(3L<sub> i</sub> - 1)(3L<sub> i</sub> - 2)L<sub> i</sub>   (i = 1, 2, 3, 4)
    - 棱内结点：N<sub> 5</sub> = 9/2L<sub> 1</sub>L<sub> 2</sub>(3L<sub> 1</sub> - 1)等
    - 面内结点：N<sub> 17</sub> = 21L<sub> 1</sub>L<sub> 2</sub>L<sub> 3</sub>等
  
### Serendipity单元
![avatar](https://github.com/baichenhan/MarkDownPictures/raw/main/Serendipity.jpg)

![avatar](https://github.com/baichenhan/MarkDownPictures/raw/main/Serendipity_1.jpg)

![avatar](https://github.com/baichenhan/MarkDownPictures/raw/main/Serendipity_2.jpg)

### 三维Lagrange单元
![avatar](https://github.com/baichenhan/MarkDownPictures/raw/main/Lagrange_3D.png)

三维Lagrange单元的插值函数可以直接表示为三个坐标方向的Lagrange多项式的乘积，例如： N<sub> i</sub> = l<sub>I</sub><sup>(n)</sup>l<sub>J</sub><sup>(m)</sup>l<sub>K</sub><sup>(p)</sup>

### 三角形棱柱单元（五面体单元）
五面体单元的插值函数可以通过结合二维三角形单元和Serendipity（或Lagrange）单元的插值函数得到，如对于二次单元：
- 角结点：N<sub> 1</sub> = 1/2L<sub> 1</sub>(2L<sub> 1</sub> - 1)(1 + ζ) - 1/2L<sub> 1</sub>(1 - ζ<sup>2</sup>)等
- 三角形边内结点：N<sub> 10</sub> = 2L<sub> 1</sub>L<sub> 2</sub>(1 + ζ)等
- 矩形边内结点：N<sub> 7</sub> = L<sub> 1</sub>(1 - ζ<sup>2</sup>)等

### 阶谱单元
阶谱单元是为了在自适应有限元中，当低阶单元对问题的分析精度不够时，在单元网格划分不变的条件下，提高单元的阶次而已经形成的低阶单元的刚度矩阵等特性保持不变地仍被利用。

需要指出：在阶谱单元中，结点参数不一定都具有结点函数值的物理意义了，因此原标准c<sub>0</sub>型单元插值所具有的性质现在也不再保持了，但单元的收敛性质并未改变。

一维阶谱单元阶谱函数的构造方式是，首先利用线性插值函数构造与单元两端相联系的线性项H<sub>1</sub>和H<sub>2</sub>，而后H<sub>3</sub>，H<sub>4</sub>，H<sub>5</sub>等高阶阶谱函数是在两端点取0并依次为二次，三次，四次等的任意函数，最重要的是，当单元阶次增加时，已形成的低阶阶谱函数不需要修改或重新构造。

## 第四章 等参单元和数值积分
### 等参变换及条件
将自然坐标中的几何形状规则的单元转换为笛卡尔坐标中几何形状扭曲的单元，建立坐标变换：坐标变换的关系式和插值函数的表达式 Φ = $\sum_1^n$N<sub>i</sub>Φ<sub>i</sub>在形式上相同。若坐标变换和函数插值采用相同的结点，并用相同的插值函数，即m = n, N<sub>i</sub>' = N<sub>i</sub>,则称变换为等参变换（若 m > n 为超参变换，m < n 为次参变换或亚参变换。

等参变换的条件：两个坐标之间一对一变换的条件是Jacobi行列式|**J**|不等于0。具体来看在二维有限元分析中|**J**| = |dξ||dη|sin(dξ,dη) / dξdη,则在二维情况下，满足|dξ| $\ne$ 0, |dη| $\ne$ 0,且dξ,dη不共线即可等参变换。而推广到三维的情况，应防止两个结点退化到一个结点而造成|dξ|，|dη|，|dζ|中有任一个为0，也要防止因单元过分歪曲而导致的dξ,dη,dζ中任意两个发生共线而使sin值为0.

等参单元的收敛性：
- 完备性：对于超参单元，即 m > n，完备性通常是不满足的。对于次参，等参单元，满足完备性要求，具体来说，对于等参单元只要母单元满足$\sum_1^n$N<sub>i</sub> = 1,则子单元满足更严格的完备性要求。对于次参单元，只要$\sum_1^n$N<sub>i</sub> = 1，则次参单元满足完备性要求，而$\sum_1^n$N<sub>i</sub> = 1在构造插值函数的时候已经满足。
- 协调性：只要适当划分网格和选择单元，等参元是完全能满足协调性条件的。

### 数值积分方法
一维数值积分：一维问题数值积分的基本思想是：对于$\int_a^b$F(ξ)dξ,构造一个多项式φ(ξ),使得在ξ<sub>i</sub> (i = 1,2,…,n)上有φ(ξ<sub>i</sub>) = F(ξ<sub>i</sub>)，然后使用近似积分φ(ξ)的积分$\int_a^b$φ(ξ)dξ来近似原被积函数F(ξ)的积分$\int_a^b$F(ξ)dξ，按照积分采样点的位置，通常有两种积分方案：
- Newton-Cotes积分：包括积分域端点在内的积分点按等间距分布，近似多项式可以取n-1阶的Lagrange多项式，由于n个积分点的Newton-Cotes积分构造的近似函数是n-1阶多项式，所以n个积分点的Newton-Cotes积分可以达到n-1阶精度，即如果原被积函数是n-1阶多项式，则积分结果是精确的。这种积分方式用于被积函数只便于等间距取样的情况是比较合理的，但是在有限元的分析中，编程计算单元内任意点的被积函数值是比较方便的，因此也可以不必受等间距分布积分点的限制，可以通过优化积分点的位置提高精度，高斯积分是这种方案中最常用的一种。
- 高斯积分：积分采样点不是等间距分布，而是依照如下图所示方法确定：![avatar](https://github.com/baichenhan/MarkDownPictures/raw/main/Gauss.png)
    而由此可知，P(ξ)具有以下性质：
    - 在积分点上有P(ξ<sub>i</sub>) = 0
    - 多项式P(ξ)与ξ<sup>0</sup>,ξ<sup>1</sup>,ξ<sup>2</sup>,…,ξ<sup>n-1</sup>在(a,b)域内正交

应该指出高斯积分和Newton-Cotes积分虽然在形式上是相同的，但实质上是有区别的，区别在于：
- 在高斯积分中φ(ξ)不是n-1次多项式，而是包含F(ξ<sub>i</sub>) (i = 1,2,…,n)和β<sub>i</sub>(i = 1,2,…,n-1)共2n个系数的2n-1次多项式
- 积分点不是等间距分布，而是由上述图片所表示的n个条件所确定的
- 正是由于φ(ξ)是2n-1次的多项式，因此n个积分点的高斯积分可以达到2n-1阶的精度，也就是说，如果原被积函数是2n-1次的多项式，则积分结果是精确的

二维和三维的高斯积分：二维和三维积分可以采用与解析方法计算多重积分相同的方式，先计算内层积分，保持外层积分变量为常量。对于二维积分：
![avatar](https://github.com/baichenhan/MarkDownPictures/raw/main/Gauss_2.png)
对于三维积分同理，且在实际中，各个坐标方向可以选取不同的积分点数，采用不同的积分方案。

Irons积分：Irons积分是较高斯积分方案效率更高的积分方案，可以直接写成一次求和的方式，例如对于20点等参单元，由Irons积分公式给出的14点积分方案基本可以达到高斯27点(3x3x3)积分同样的精度效果，因此应用广泛。

Hammer积分：
![avatar](https://github.com/baichenhan/MarkDownPictures/raw/main/Hammer.png)
Hammer等导出了这种积分限中包含变量自身的积分方案，这种表述形式可以很方便的与Irons积分一起编织统一的计算机程序进行数值积分。

### 等参元计算中数值积分阶次的选择
数值积分的阶次会直接影响积分的精度和工作量，选择积分阶次的原则如下：
1. 保证积分精度：以一维刚度矩阵的积分为例，若插值函数项数为P，微分算子的导数为m阶，则有限元被积函数为2(p-m)次多项式(对于等参元假设|**J**|为常数，则为保证精度，应选择高斯积分阶次n=p-m+1，这时精确积分至2(p-m)+1次多项式，达到精确积分刚度矩阵的要求)
   - 但在很多情况下，实际选取的高斯积分点数低于精确积分的要求，这种高斯积分阶次低于被积函数所有项次精确积分所需阶数的方案称为缩减积分，实际计算表明，利用缩减积分往往可以取得较完全精确积分更好的精度，这是由于：
     - 精确积分常常是由插值函数中非完全次最高次方要求，而决定有限元精度的是完全多项式的方次。低阶次的高斯积分，实质是利用一种新的插值函数代替原来的插值函数，使积分精度完全满足完全多项式方次的要求，而不包括非完全多项式的要求，从而改善了单元精度，又称为优化积分，是缩减积分的一种。
     - 基于最小位能原理建立的位移有限元，其解具有下限性质，即结果具有较实际结构偏大的整体刚度，使用缩减积分方案可使刚度有所降低，有助于提高计算精度。
2. 保证结构总体刚度矩阵是非奇异的：求解系统方程[K][a] = [P],要求有解则[K]<sup>-1</sup>必须存在，即引入强制边界后[K]必须是非奇异的，即|**K**| $\ne$ 0,总刚矩阵满秩。
   - 对于矩阵秩的运算有如下基本规则：
     - 矩阵相乘秩规则：[B] = [U][A][V],则秩B <= min(秩U,秩A,秩V),即矩阵相乘后的秩，必然小于最多等于相乘秩中的最小者
     - 矩阵相加秩规则：[C] = [A] + [B],则秩C <= 秩A + 秩B,即矩阵和的秩必然小于最多等于矩阵秩的和
   - 由以上可以推出，若位置场变量[a]的元素数目超过全部积分点能提供的独立关系数，则[K]必是奇异的。在采用缩减积分时，系统应变能未能被精确计算，对于某些除刚体运动外的位移模式，在缩减积分点可能正好等于0，则会导致[K]非奇异的必要条件不成立。
   - 在实际分析中，要防止零能模式（由于采用缩减积分而导致的应变能为0，而自身有别于刚体运动的位移模式）的出现，也即在采用缩减积分时，必须注意检查[K]的非奇异性条件是否满足。

## 第五章 有限单元法应用中的若干实际考虑
### 应力计算结果的性质与处理
通过对插值函数[N]求导求出的应变[ε]和应力[σ]，由于求一次导多项式次数就降低一次，所以精度较位移[u]来说降低了，即由[ε] = [B][a<sup>e</sup>]和[σ] = [D][ε] = [D][B][a<sup>e</sup>]所求出的应力应变可能有较大的误差。

应力解的误差表现在：
- 单元内部不满足平衡方程
- 单元与单元的交界面上，应力一般不连续
- 力的边界S<sub>σ</sub>上一般也不满足力的边界条件

### 应力近似解的性质
可以推出，求解$\prod$<sub>ρ</sub>z(u<sup>\*</sup>)极小值的问题，从力学上解释是求解位移变分所引起的应变能为极小值的问题；从数学上解释是求解应变差值ε<sup>\*</sup> - ε 或应力差值σ<sup>\*</sup> - σ的加权二乘最小值的问题。由此我们可以认识应变和应力近似解ε<sup>\*</sup>和σ<sup>\*</sup>的性质，它们是真实应变与应力在加权最小二乘意义上的近似解。近似解应变和真正解应变的差值应满足加权D的最小二乘，近似解应力和真正解应力应满足加权C的最小二乘。

从以上可以得出应变解和应力解的一个重要特点：应变近似解和应力近似解必然在真正解上下震荡，并在某些点上，近似解正好等于真实解。也即在单元内存在最佳应力点。应力解的此特点有助于我们处理应力计算的结果，改善应力解的精度。

### 等参元的最佳应力点
在一般的情况下，我们不能判定真正解多项式的次数但是可以得到以下推论：在等参元中，单元中n+1阶(n=p-m)高斯积分点上的应变或应力近似解比其它部位具有较高的精度，因此称(n+1)阶高斯积分点是等参元的最佳应力点。

由位移元得到的位移解在全域范围上是连续的，应变和应力解在单元内部是连续的而在单元间是不连续的，即在单元边界上发生突跳。因此同一个结点，由围绕它的不同单元计算出的应力应变值是不同的。另一方面，在边界上应力解一般也与力的边界条件不符。虽然等参元在n+1阶高斯积分点（最佳应力点）上具有较高的应力精度，但在结点上计算得到的应力精度却较差，通常工程中更关注单元边缘和结点上的应力，因此需要采用应力处理方法进行应力处理。

### 应力处理方法
- 取相邻单元应力平均值：常见于三角形单元，应力解在单元内是常数，可看作单元内应力平均值或三角形形心处应力值，由于应力近似解在真解上下震荡，可取相邻单元应力平均值作其组成的平行四边形形心处的应力值，取得更好的应力计算结果。
  - 取平均可以用算数平均值： 平均应力 = 1/2(单元①应力 + 单元②应力)
  - 也可采用精确些的面积加权平均： 平均应力 = (单元①应力 * 单元①面积 + 单元②应力 * 单元②面积) / (单元①面积 + 单元②面积)
- 取围绕结点各单元应力的平均值：取围绕该结点周围的相关单元计算得到该结点的应力的平均值： σ<sub>i</sub> = 1/m$\sum_1^m$σ<sub>i</sub><sup>e</sup>,式中的1~m表示围绕在i结点周围的全部单元，取平均值时也可以按照面积加权平均。应该注意这样得到的结点应力值是围绕该节点的有限区域内的应力平均值，这种方法并不能从根本上改善等参元的结点应力精度差的问题。
- 总体应力磨平：可以利用总体应力磨平的方法改进应力的计算结果，得到在全域内连续的应力场。方法是构造一个改进的应力解[ε],此改进的应力解在全域内连续，改进解与有限元法求得的应力解应该满足加权最小二乘的原则，建立如下泛函：
![avatar](https://github.com/baichenhan/MarkDownPictures/raw/main/zongtimoping.png)

   - 式中M是单元总数，[σ<sup>*</sup>]是利用位移元解出的位移场求解的应力解，[σ]是待求的应力改进值。总体应力磨平会得到一个N\*S的方程组，其中N是进行应力磨平的全部单元的总数，S是应力分量数，求解该方程组可以得到各个结点应力改进值，再代入计算可以得到各单元的应力改进值。
   - 应力总体磨平的主要缺点是计算量十分庞大，方程的总阶数为N*S，若位移求解与应力总体磨平采用一致的结点数N，则N\*S会大大超过原位移场的系统方程阶数（位移自由度总小于应力分量数），总体应力磨平将消耗比原来求解位移场更多的机时。相当于进行了两次有限元计算，一次求位移场，一次求应力场。
- 单元应力磨平：当单元的尺寸不断缩小时，单元的加权最小二乘和未加权最小二乘是相当的，由于函数的正定性，全域的加权最小二乘是各单元最小二乘的和，因此当单元足够小的时候，磨平可以在各个单元内进行。
   - 由于采用了不加权的最小二乘，各应力分量不再耦合，因此按此方式磨平应力相当于将各个应力分量分别磨平，由此我们可以只磨平我们有兴趣的应力分量，而不一定要将所有应力分量都磨平。
   - 采用单元局部应力磨平的方法，对于同一结点，由不同的相邻单元求得的应力改进值通常是不同的，可以把相关结点的改进应力值再取平均值做最后的结点应力值。
   - 一般情况下，采用应力局部磨平处理可以得到较好的结果，而计算量是很小的，所以得到广泛应用。
- 子域局部应力磨平及外推：单元局部应力外推不能充分利用最佳应力点具有的高一阶的精度，同时不能在单元交界面上连续，而总体磨平计算量又太大，可以采用子域局部应力磨平，比单元局部磨平效果更好，且计算量也不会太大。
    - 子域可以选择实际工程感兴趣的区域，比如应力集中区域或需要专门核校应力的区域。
    - 子域应力磨平改进解的方案：
      - 应力改进解仍采用结点应力的插值表达式
        
        这种方式和总体应力磨平方式相同，仍然构造泛函，只是单元的总数M采用仅在子域内的单元数目
      - 应力改进解采用解析函数的形式

        在整个子域内假设改进后的应力解的解析表达式，其中包含待定系数，要求解析解[σ]和原有限元解[σ*]满足加权的或不加权的最小二乘，以此来确定待定系数。若预先使待定系数满足平衡方程和力的边界条件，则可以得到更好的结果。

        确定了待定参数后，可由改进解的解析表达式求得局部区域内任一点的改进后的应力值。改进后的应力场在这个被磨平的局部区域中呈连续分布，并且有与原有限元应力解符合最小二乘的性质。当各个应力分量分别磨平（不加权的最小二乘）时，改进应力解和原应力解误差的平方在被磨平的局部区域上的和达到最小。

        当网格划分合适时，可选取一个单元条进行局部应力处理，磨平仍采用不加权的最小二乘，因此各应力分量可以分别进行磨平。又因为局部区域是一个狭窄的单元条，因此可以按一维问题沿单元条方向磨平，计算简单，结果良好。
- 引入力的边界条件修正边界应力：在实际工程问题中，所关心的最大应力往往出现在边界上，为了在边界上得到更精确的应力值，可直接引入力的边界条件来修正边界的应力值。引入边界条件修正后的边界应力值较未修正的边界应力有相当大的改进。

### 子结构法
采用子结构法可以大量减少数据的准备和输入，单元矩阵的计算以及系统方程的求解的工作量，还可以减少对计算机储存量的需求。可以采取子结构方法的两种情况：
1. 结构可以划分出分块相同的部分，可取相同部分的结构作为子结构，例如框架梁，相同子结构越多，计算效率越高。
2. 某些结构方案的变化只是在局部，而其余部分不变，则可以将不变的部分的结构划作若干个子结构，变化部分划作另外的子结构，当结构变化时，只需改其中一两个子结构就可以了。
   
子结构计算中需要讨论两方面的问题：
- 内部自由度的凝聚：在内部自由度凝聚之前，子结构实际上是一个具有相当多内部自由度的超级单元。为了减少系统的总自由度，在子结构与其他子结构或单元联结前，应在该层子结构内将
- 坐标转换：若每层子结构局部坐标建立的方向是不同的，则需要在集成结构前进行必要的坐标转换，变换后可作子结构的集成，这个集成过程和一般单元一样，每个子结构的作用和一个普通单元一样。若是多层子结构，则每层都需要自由度凝聚和坐标转换，然后集成，再自由度凝聚，直至最外一层子结构。

### 结构对称性和周期性的利用
工程实际中，很多结构具有对称性和周期性，如能确当地加以利用，可使结构的有限元计算模型和计算规模得到缩减，从而使各方面工作量大大降低，具体可分为三种情况：
- 具有对称面结构
- 轴对称体受非轴对称载荷的情况
- 旋转周期结构：
  - 沿周向周期性变化的载荷情况
  - 沿周向任意变化的载荷情况

### 非协调元和分片实验
等参元有良好的适应性和表达方式的简明性，但从严格意义上讲，它的精度和效率仍是不够高的，以二维单元为例，二维等参元中有四分之一的结点自由度对计算精度是不起作用的。另一个方面，插值函数中非完全的高次项非但对改善精度不起作用，而且可能起相反的作用。

而E·Wilson提出的二维、三维的非协调等参元，对改进等参元的计算精度和提高计算效率很有意义，特别是对于三维问题的有限元分析。

#### Wilson非协调单元
为改善二维线性单元的性质，提高其精度，Wilson提出在单元的位移插值函数中附加内部无结点的位移项，当单元是等参元，采用自然坐标时，此附加项为α<sub>1</sub>(1-ξ<sup>2</sup>)和α<sub>2</sub>(1-η<sup>2</sup>)，而他们正是利用二维双线性单元模拟纯弯应力状态造成误差的原因所在。增加附加项后就有可能调整α<sub>1</sub>，α<sub>2</sub>使误差降到最小。

从数学方面来看，是通过引入了ξ<sup>2</sup>和η<sup>2</sup>项使插值函数中的二次式趋于完全，从而达到了提高计算精度的目的。

由于单元内增加了附加位移量而致使单元之间不能保证在交界面上的唯一连续性，引入非协调项的单元称为非协调元，显然非协调元是违反有限元的收敛准则的。

为了检验采用非协调元的任意网格划分时能否达到上述连续性的要求，可以进行分片试验，若能通过分片试验则解的收敛性就能得到保证。

#### 分片试验
设在一个单元片中，结点i是完全被单元所包围的，如下图，则i的平衡方程为：$\sum_{e=1}^m$(**$K_{ij}^ea_j$** - **$P_j^e$**) = 0，其中m为单元片中包含的单元数，j是除i外其他结点的统称。

![avatar](https://github.com/baichenhan/MarkDownPictures/raw/main/fenpian.png)

分片试验是指：当赋予单元片各结点以与常应变状态相应的位移值和载荷值时，校验以上方程是否满足，若满足则通过分片试验，也即单元满足常应变要求，因此当单元尺寸不断缩小时，有限元解收敛于真解。

分片试验的另一种提法是：当分片的边界结点赋予和常应变相应的位移值时，求解$\sum_{e=1}^m$**$K_{ij}^ea_j$** = 0，得到分片的内部结点i的位移值**a<sub>i</sub>**,若其与常应变状态相一致，则认为通过分片试验。通常认为前一种提法应用更广泛和方便，因为后一种要涉及矩阵的求逆运算。

## 第六章 线性代数方程组的解法
在静力平衡问题的有限元格式中，确定了离散所需的格式后，最后需要求解一组联立的线性代数方程组，即[K][a] = [P]。在静力平衡问题中，就是以结点位移为基本未知量的系统结点平衡方程。在求解稳定温度场的过程中，就是以结点温度为基本未知量的系统结点热平衡方程。有限元求解的效率很大程度上取决于这组线性代数方程组的解法。

有限元中的刚度矩阵[K]具有大型，稀疏，对称，带状分布，以及正定，主元占优势等特点，要加以利用。

线性联立方程组的解法：
- 直接解法：
  - 以高斯消去法为基础，计算效率高，舍入误差大，适合低阶方程组
- 迭代法：
  - 高斯-赛德尔迭代法
  - 超松弛迭代法等

### 系数矩阵在计算机中的存储方法
系数矩阵一般是对称的，只存储上三角或下三角矩阵即可，但即使只存储上(下)三角矩阵，也是很稀疏且呈带状分布的，在计算机中存储时一般采用二维等带宽存储或一维变带宽存储。

#### 二维等带宽储存
对于n阶系数矩阵，若最大半带宽为D，则上三角阵中所有非0元都将包括在这一条以主对角线元素为一边的一条等宽带中，二维等带宽储存就是将这样条带中的元素，存到一个规整的二维数组(n*D)中。

![avatar](https://github.com/baichenhan/MarkDownPictures/raw/main/erweidengdaikuan.png)

二维等带宽存储，相较全部上三角元素大大节省了内存，但是由于取最大的带宽为存储范围，不能排除在带宽范围内的零元素。一般在矩阵带宽变换不大时采用二位等带宽存储，变化大时，采用一维变带宽存储。

#### 一维变带宽储存
一维变带宽储存就是把变化的带宽内的元素按一定的顺序存储在一维数组中，由于不按最大带宽存储，在带宽变化较大的矩阵中能节省大量内存，可分为按行一维变带宽存储和按列一维变带宽存储。

![avatar](https://github.com/baichenhan/MarkDownPictures/raw/main/yiweibiandaikuan.png)

以按列一维变带宽存储为例，按列一维变带宽存储是按列依次存储元素，每列从主对角线元素依次直至最高（行号最小）非0元素为止。对于此方法，夹在同一列两个非零元之间的0也是必须存储的，只是不用存储同一列中上边的零元。

同时，由于带宽可变，必须有辅助数组记录原矩阵的形状，如每列的元素个数等，所采用的方法是增加一个辅助数组M(n+1)，用来记录每行的主对角元素在一维数组中的索引。

### 高斯消去法及其变体
#### 高斯消去法
全程高斯循序消去法，全过程需要n-1次消元，再回代。具体思想是从第一行开始，第m次消元以第m-1次消元后的第m行元素为主元行，$K_{mm}^{(m-1)}$为主元，对（i > m）的所有行消去主元，直至最后只剩一个未知数，再依次回代解出所有未知数。例如下图：

![avatar](https://github.com/baichenhan/MarkDownPictures/raw/main/Gauss_xiaoqu.jpg)

高斯消去过程的一般规律：
1. 若原系数矩阵是对称矩阵，则可以证明消元过程中的待消矩阵仍保持对称，因此对称矩阵消元时，有可能只在计算机中存储系数矩阵的上三角或下三角部分就可以，不必存储整个矩阵。
2. 消元最后得到的第i行元素是第(i-1)次消元的结果，即
   $$K_{ij}^{(n-1)} = K_{ij}^{(i-1)} = S_{ij}$$
   $$P_i^{(n-1)} = P_i^{(i-1)} = V_i$$
3. 自由项阵列[P]消元时所用到的元素都是系数矩阵消元最后的结果，因此[P]的消元可以与系数矩阵[K]同时进行，也可以在[K]消完后，再对[P]消元。在用有限元法解题时，若有多组载荷，即多组[P]阵列，则刚度矩阵只需要消一遍元，多组[P]可分别利用消元后的刚度矩阵结果进行求解，大大节省机时。

#### 高斯-约当消去法
一般的高斯消去法是将方程的系数矩阵消成一个上三角，而后进行回代求解。高斯-约当消去法是将方程的系数矩阵消成一个单位对角阵，这样消去后的自由项列阵就是代数方程的解，没有回代过程。

高斯-约当消元的过程为：使每行的主元系数为1，然后向下消去其他列中的此元，再将下面行的结果回代到上面行中，消去上面的非主元，得到单位对角系数阵，而增广部分就是其解。例如下图：

![avatar](https://github.com/baichenhan/MarkDownPictures/raw/main/Gauss_yuedang.jpg)

#### 二维等带宽存储的高斯消去法
对于二维等带宽存储方式的高斯消去法，由于非零元素是呈带状分布的，因此第m列存在非零元素的方程最多只可能是包括第m个方程在内的共计D个方程，以后的方程第m列元素必然为0，不需要修正。因此每次消元涉及修正的方程只是m个方程后的D-1个方程，工作三角形内需修正的元素个数为1/2D(D-1)个，由于考虑了带状分布的特点，高斯消去法所需修正的元素减少了，大大提高了计算效率。

### 三角分解法
#### 三角分解定理
设n阶矩阵**A**的所有主子式均不为0，则**A**必然可以分解为一个下三角阵**L**和上三角阵**S**的乘积，即有**A = LS**，当**L**或**S**为单位三角阵时，这种分解是唯一的，称为crout分解。

在有限单元法中，代数方程组的系数矩阵[K]是对称正定矩阵，主子式恒大于0，必然可以进行三角分解。

系数矩阵可以分解为**K = LS**，则原代数方程**Ka = P**，可以写成**LSa = P**，高斯消去的过程相当于在方程两端同乘L<sup>-1</sup>，L<sup>-1</sup>LSa = L<sup>-1</sup>P,令L<sup>-1</sup>P = V,有Sa = V，上式中的S是K经消元后得到的上三角矩阵，V是列阵P消元的结果。

三角分解后，方程的求解可以分为两步：
1. 求V
   
   由L<sup>-1</sup>P = V 得到 LV = P，且L是下三角矩阵，向前回代即可求出V
2. 求基本未知量**a**
   
   由**Sa = V**式求未知量**a**，且S是上三角矩阵，求**a**只需要向后回代

由上述过程可见，三角分解法求解线性代数方程的关键是对系数矩阵三角形的分解，由于**K**是对称矩阵，可以分解得到**K = LDL<sup>T</sup>**，其中D是对![3D_1](/assets/3D_1.png)角阵，DL<sup>T</sup> = S，所以分解的主要目的是得到D和L<sup>T</sup>矩阵。

#### 三角分解的递推公式
由于**K = LDL<sup>T</sup>**，根据矩阵的乘法规则，有
$$K_{ij} = \sum_{r=1}^nl_{ir}d_{rr}l_{ri}^T = \sum_{r=1}^nl_{ri}^Td_{rr}l_{rj}^T$$
其中，$K_{ij},l_{ir},d_{rr},l_{rj}^T$分别是矩阵K，D，L，L<sup>T</sup>中的元素。且L<sup>T</sup>为L的转置，有$l_{ir}=l_{ri}^T$，L<sup>T</sup>为上三角矩阵，因此有r > i 时，$l_{ri}^T = 0$;  r > j 时，$l_{rj}^T = 0$

当K<sub>ij</sub>为K中上三角阵中的元素时，则 j >= i;因此$\sum$中r = 1~n可以改成r = 1~i，得：
$$K_{ij} = \sum_{r=1}^il_{ri}^Td_{rr}l_{rj}^T = \sum_{r=1}^{i-1}l_{ri}^Td_{rr}l_{rj}^T + l_{ii}^Td_{ii}l_{rj}^T$$
且L<sup>T</sup>为单位上三角矩阵，因此主对角线元素为1，由上式可得递推关系式
$$d_{ii}r_{ij}^T = S_{ij} = K_{ij} - \sum_{r=1}^{i-1}l_{ri}^Td_{rr}l_{rj}^T, 且l_{ij}^T = S_{ij} / d_{ii},且d_{ii} = S_{ii}$$

三角分解的过程可以对原系数矩阵按行或者按列分解，且由于系数矩阵是对称的，只需要分解系数矩阵的上三角部分即可。

1. 按行分解：
   $$第一行 i = 1$$
   $$S_{1j} = K_{1j} (j >= 1)$$
   $$d_{11} = S_{11} = K_{11}$$
   $$l_{1j}^T = S_{1j} / d_{11} (j > 1)$$
   $$第二行 i = 2$$
   $$S_{2j} = K_{2j} - l_{12}^Td_{11}l_{1j}^T(j >= 2)$$
   $$d_{22} = S_{22}$$
   $$l_{2j}^T = S_{2j} / d_{22} (j > 2)$$
   $$第i行 S_{ij} = K_{ij} - \sum_{r=1}^{i-1}l_{ri}^Td_{rr}l_{rj}^T (j >= i)$$
   $$d_{ii} = S_{ii}$$
   $$l_{ij}^T = S_{ij} / d_{ii} (j > i)$$

2. 按列分解：
   $$第一列 j = 1$$
   $$i = 1,d_{11} = S_{11} = K_{11}$$
   $$第二列 j = 2$$
   $$i = 1,S_{12} = K_{12},l_{12}^T = S_{12} / d_{11}$$
   $$i = 2,d_{22} = S_{22} = K_{22} - l_{12}^Td_{11}l_{12}^T$$
   $$第三列$$
   $$i < j,S_{ij} = K_{ij} - \sum_{r=1}^{i-1}l_{ri}^Td_{rr}l_{rj}^T,l_{rj}^T = S_{ij} / d_{ii}$$
   $$i = j,d_{ii} = S_{ii} = K_{ii} - \sum_{r=1}^{i-1}l_{ri}^Td_{rr}l_{ri}^T$$

在三角分解时，系数矩阵K只存在上三角，分解结果L<sup>T</sup>仍可以存放在K原来的储存空间中，由于L<sup>T</sup>是单位上三角矩阵，对角线均为1可以不存，所以可以利用对角线来存储对角阵D。

#### 带状分布特点下的三角分解递推公式
1. 系数矩阵K采用二维等带宽存储
   二维等带宽存储的矩阵与原阵的行列下标关系为：i<sup>\*</sup> = i, j<sup>\*</sup> = j - i + 1,其中i<sup>\*</sup>，j<sup>\*</sup>为二维等带宽存储中的新下标，i，j为原系数矩阵的下标。
   设二维存储宽度为D，令J = j<sup>\*</sup> - i + 1, 则原递推公式可以改为：
   $$S_{ij} = K_{ij} - \sum_{r=J+i-D}^{i-1}l_{r,i-r+1}^Td_{r1}l_{r,J+i-r}^T (J < D)$$
   $$S_{ij} = K_{ij} (J = D)$$
   $$l_{iJ}^T = S_{iJ} / d_{i1}$$
   行列的循环周界也需要按照等带宽存储的情况修正
   - i = 2,3,…,n
   - J = 1,2,…,D
   - r = J+i-D,…,i-1
2. 系数矩阵K采用一维变带宽存储
   设m<sub>j</sub>为j列第一个元素的行号，对于j列第一个元素有S<sub>m<sub>j</sub>,j</sub> = K<sub>m<sub>j</sub>,j</sub>，对于j列其他元素有$S_{ij} = K_{ij} - \sum_{r=m_n}^{i-1}l_{ri}^Td_{rr}l_{rj}^T$, m<sub>n</sub> = max(m<sub>j</sub>,m<sub>i</sub>) 由以上可以得出L<sup>T</sup>中的各元素.$L_{ij}^T = S_{ij} / d_{ii}$,$d_{ii} = K_{ii} - \sum_{r=m_i}^{i-1}l_{ri}^Td_{rr}l_{ri}^T$,原系数矩阵K中的元素K<sub>ij</sub>在一维变带宽存储A中的索引为N，N = M(j) + j - i.

   同样可以利用一维存储A来存储L<sup>T</sup>和D，行列对应关系与K和A的对应关系相同，在求得L<sup>T</sup>和D后即可利用简单的向前向后回代解出基本未知量A。

   由于分解后只储存L<sup>T</sup>和D阵，并不存储S，因此可以将**Sa = V**改写成**L<sup>T</sup>Da = V**, 令$\widetilde{V}$ = P<sup>-1</sup>V, 为修正后的载荷阵，可写为L<sup>T</sup>a = $\widetilde{V}$,可直接利用向后回代求解出a

三角分解后的求解步骤是：
1. 由 **LV = P**向前回代求出V
2. 对角阵D的逆阵也是对角阵，对角元素$d_{ii}' = 1 / d_{ii}$
3. 由$\widetilde{V}$ = D<sup>-1</sup>V求修正的分解后的载荷阵$\widetilde{V}$
4. 由L<sup>T</sup>a = $\widetilde{V}$向后回代求解基本未知量a

按行和按列的三角分解法计算量大致相当，但是按列可以多排除一些在每列第一个非零元素前的零元素，因此实际中采取按列分解较好。

#### 高斯消去法与三角分解法的比较
两种运算的实质都是利用了高斯消去原理，运算量基本相同。但是从程序运行的角度来看，程序执行过程中，三角分解法对每个元素的分解都是一次完成，读写内存的次数都只有一次，而采用高斯消去时，对每个元素都要取送1~D-1次，访存时间相差很大，因此三角分解法能比高斯消去法节省计算时间。

### 追赶法
在一维问题中，若每个结点只有1个自由度且无分叉情况(如每个结点只有一个转角自由度的连续梁)，则结构刚度矩阵将是一个三对角阵，即非零元素只存在于主对角线及其两侧的二条对角线上，如下图：
![avatar](https://github.com/baichenhan/MarkDownPictures/raw/main/zhuiganfa.png)

追赶法的原理：如线性代数方程组 **Ka = P**为三对角方程组，首先将系数分解 **K = LS**，则**L**为下三角矩阵，它只有两条对角线上有非零元素，副对角线上的元素就是原系数矩阵副对角线的元素。**S**是上三角矩阵，也只在两条对角线上有非零元素。**L**和**S**阵中的元素由下列式子确定：
$$l_1 = b_1, S_i = C_i / l_i (i=1,2,…,n-1), l_{i+1} = b_{i+1} - d_iS_i$$

这种矩阵分解其实是一种特定的三角分解，分解后，由式**LV = P**求出**V**，由**Sa = V**，求出**a**，具体为：
$$V_1 = P_1 / l_1, V_i = (P_i - d_{i-1}V_{i-1}) / l_i (i=2,3,…,n)$$
$$a_n = V_n, a_i = V_i - S_ia_{i+1} (i=n-1,n-2,…,2,1)$$
在有限元法中，**K**是对称阵，因此 $d_i = c_i$，分解**L,S**中的$c_i$可以换成$d_i$，使用追赶法时，分解的矩阵可以占用原系数矩阵的位置，求出的V和a可以利用原方程自由项P的位置。

### 分块解法
采用有限元法求解时，为了达到一定的精度要求，往往离散模型划分的单元数较多，结点和结点自由度也很多，得到的求解方程阶数一般都很高，系数矩阵往往不能全部进入计算机内存中进行计算，在内存容量不足时，可以利用分块解法和波前法来解决。

对高斯消去法的进一步分析得到：
1. 结构刚度矩阵**K**中的元素K<sub>ij</sub>的集成和消元可以交替进行，未集成完毕甚至未集成的元素也可以先进性消元，然后继续集成，不必要在全部元素集成后再消元。
2. 矩阵方程中的某行元素（如第m行），只要本身的集成和消元都已完毕，就可以作为主元对它以下的D-1行完成消元作用。对于被消元行（第m+1行到第m+D-1行）则不一定要求元素集成完毕。也就是说，不论被消元行的元素集成与否，消去过程都可以进行。
3. 第m次消元只涉及包括了第m行元素在内的一个有效消元区，共D个方程。对于m行以前的元素（已消元完毕）和m+D-1行以后的元素（消元有效区以外的元素）是否保存在计算机内存中，对第m次消元没有影响。
4. 不论是对自由项矩阵**P**还是系数矩阵**K**，每个元素在消元过程中逐次修正用到的元素都是集成和消元已全部完成的元素，即消元的最终结果，因此与消元过程中的中间结果无关。

#### 分块解法的原理
对高斯消去法的再分析可知结构刚度矩阵**K**不必全部进入内存，可按计算机允许的内存将结构刚度矩阵分成若干块，逐次进入内存，在每块中刚度矩阵的元素先集成后消元。

以二维等带宽存储为例，只要网格的结点编号，单元扫描合理，很容易做到进入内存的系数矩阵只有最后的D行元素没有集成完毕。若内存允许存储NQ行元素（占用内存NQ*N），则前NQ-D行都已集成完毕，可作为主元行进行循序消元，消元波及NQ-1行。然后将内存中已完成集成和消元的元素（前NQ-D行）移出内存。最后的D行元素是未完成集成和消元的，称为公共区，公共区和下一块系数矩阵一起在内存中继续集成和消元，如此进行直至全部系数矩阵集成和消元完毕，回代求解可自下而上进行。

分块解法的特点：
- 在每一分块中，系数矩阵的元素先集成后消元。
- 从求解的全过程看，系数矩阵的集成和消元交替进行。

当计算机有外存可用时，移出的系数矩阵可按块存入外存，求解出再由后向前逐块调入内存，这样分块解法较一次集成和消元只多消耗些内外存交换的时间，但却能达到求解大型问题的要求，且理论上只要内存允许的NQ > D，分块解法就可以进行。实际上只有NQ有一个适当的大小时，求解的效率才比较高，否则内外存交换的时间将占较大的比重。在无外存时，分块解法仍可进行，只是移出内存的分块无法保存，回代时需要重新生成。

![avatar](https://github.com/baichenhan/MarkDownPictures/raw/main/fenkuai_code.png)

分块解法程序的特点；
1. 只需要给出系数矩阵的允许内存大小A，分块可自动进行，不要事先人为地分块。当计算问题规模较小时，就是通常的一次集成和消元，当问题规模较大时则自动进行分块。
2. 分块是以用满最大允许内存A为原则，因此当A按计算机许可的最大允许系数矩阵所占内存给出时，分块解法能自动充分利用计算机内存分块。
3. 在理论上，系数矩阵在计算机内的允许内存只要大于D(D+1)，分块解法就能实现。D是求解问题中系数矩阵包括主元在内的半带宽。因此最小内存要求与带宽有关，结点自由度仍按结点编码顺序自然排列。

#### 波前法
采用高斯循序消去法和三角分解法时，方程一般按结点自然编号排列，在有些情况下自然顺序的半带宽D很大，而且有很多零元素，造成工作三角形很大。这时可以利用波前法，其特点是刚度矩阵**K**和载荷矩阵**P**不按自然编号而按计算时参加运算的顺序排列，在内存中只保留尽可能少的一部分**K**和**P**元素。

波前法计算过程：
1. 按单元顺序扫描计算单元刚度矩阵及等效结点载荷阵列并送入内存进行组装。在**K**和**P**中集成尚未完毕的自由度称为不活动变量，不活动变量可以作为主元对其他非主元进行消元。内存中存储刚度矩阵**K**元素的三角形称为波前三角形，在波前三角形中活动变量和主元按一定顺序构成波前，波前中变量的个数叫做波数，记作W。
2. 检查哪些自由度已集成完毕，以集成完毕的自由度作为主元，对其它行列的元素进行消元修正。
3. 对其它行列元素完成消元修正后，主元已完成消元作用，将主元行有关元素K<sub>ij</sub>，P<sub>i</sub>送入外存，共有W+1个数，送入外存的元素是一个代数方程组中一个方程的系数和自由项：$$K_{ia}a_a + K_{ib}a_b + … +K_{ii}a_i + … = P_i$$方程由哪些自由度组成是由主元行i行未送出内存时的波前决定，因此在把主元行的元素送入外存前需要记录有关信息：
   - 主元行号
   - 主元在波前中的位置
   - 波前数W
以后要用这些信息来恢复波前
4. 重复步骤1~3，将全部单元扫描完毕，在最后一个单元扫描完成后，内存中全部自由度已集成完毕，此时可以直接消元后回代求解，得到最后内存中几个未知量a<sub>i</sub>的解。
5. 按照消元的顺序，由后向前逐个恢复波前，送到外存的元素，依次回代求解。恢复波前需要用到AIW等信息，在现有内存基础上，根据A、I可将自由度A插在I上，然后根据W取出前W个自由度即为恢复的上一个波前，恢复一个波前就顺序从外存调入一组元素（后出先入），依次求解方程组的解。

一般波前法的扫描可以有两种次序：
1. 按单元编码的顺序进行扫描
2. 按自由度进入内存的顺序，保证先进入内存的自由度首先集成完毕作为主元推出波前。即按照先进先出的次序扫描。

前者的扫描过程更加方便，后者恢复波前较简单，波前区较小，但是需要耗费更多的扫描时间。

#### 波前法与分块解法的比较
分块解法：
- 自由度集成完成一批消去一批
- 允许系数矩阵占用的内存大于D(D+1)即可求解
- 利用内存更加充分
- 内外存交换次数相对较小
- 无外存时也能求解
- 程序的实现比较简单

波前法：
- 自由度集成完成一个消去一个
- 允许系数矩阵占用的内存大于最大波前区就可求解
- 内存的要求比分块解法更小
- 内外存交换频繁
- 无外存时不能进行求解
- 程序实现比较复杂有难度